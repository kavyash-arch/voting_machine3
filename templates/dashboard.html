<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <style>
    /* Tab navigation styling */
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab-button {
      background-color: #025373;
      color: white;
      border: none;
      padding: 12px 20px;
      margin: 0 5px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .tab-button:hover {
      background-color: #025E73;
    }
    .tab-button.active {
      background-color: #037F8C;
    }
    .tab-content {
      display: none;
      background-color: rgba(255, 255, 255, 0.85);
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .tab-content.active {
      display: block;
    }

    /* Toast popup */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #28a745;
      color: white;
      padding: 15px 20px;
      border-radius: 6px;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      z-index: 1000;
    }
    .toast.show {
      opacity: 1;
    }

    h2, h3 {
      font-family: "Play", serif;
      color: #025373;
    }
  </style>
</head>
<body>

  <div class="admin_dashboard_container">
    <h2>Admin Dashboard</h2>

    <!-- Tab Navigation -->
    <div class="tab-container">
      <button class="tab-button active" onclick="openTab(event, 'create')">Create Event</button>
      <button class="tab-button" onclick="openTab(event, 'list')">Event List</button>
      <button class="tab-button" onclick="openTab(event, 'scores')">Idea Scores</button>
    </div>

    <!-- 1. Create Event -->
    <div id="create" class="tab-content active">
      <h3>Create New Event</h3>
      <form class="form-inline" method="POST" action="{{ url_for('create_event') }}">
        <input type="text" name="event_id" placeholder="Event ID" required>
        <input type="text" name="event_name" placeholder="Event Name" required>
        <select name="is_active">
          <option value="1">Active</option>
          <option value="0">Inactive</option>
        </select>
        <input type="submit" value="Create Event">
      </form>
    </div>

    <!-- 2. Event List -->
    <div id="list" class="tab-content">
      <h3>Event List</h3>
      <table>
        <thead>
          <tr>
            <th>Event ID</th>
            <th>Event Name</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for event in events %}
          <tr>
            <td>{{ event.id }}</td>
            <td>{{ event.name }}</td>
            <td>
              {% if event.is_active %}
                <span class="status-active">Active</span>
              {% else %}
                <span class="status-inactive">Inactive</span>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('set_active', event_id=event.id) }}">
                <button>{% if event.is_active %} Active {% else %} Set Active {% endif %}</button>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- 3. Idea Scores -->
    <div id="scores" class="tab-content">
      <h3>Idea Scores</h3>
      <table>
        <thead>
          <tr>
            <th>Idea</th>
            <th>Judge Score</th>
            <th>Audience Score</th>
            <th>Total Score</th>
          </tr>
        </thead>
        <tbody>
          {% for idea in ideas %}
          <tr>
            <td>{{ idea.name }}</td>
            <td id="judge_score_{{ idea.id }}">{{ idea.score_judge }}</td>
            <td id="audience_score_{{ idea.id }}">{{ idea.score_audience }}</td>
            <td id="total_score_{{ idea.id }}">{{ idea.total_score }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="winner">
        Winner: 
        <span id="winner_name">
          {% if winner %}{{ winner.name }}{% else %}No winner yet{% endif %}
        </span> 
        with score 
        <span id="winner_score">
          {% if winner %}{{ winner.total_score }}{% else %}0{% endif %}
        </span> ðŸŽ‰
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast"></div>

  <script>
    // âœ… Tab Switching
    function openTab(evt, tabId) {
      document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      evt.target.classList.add("active");
    }

    // âœ… Real-time score updates
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
    socket.on('update_scores', function(data) {
      let scores = data.scores;
      let winner = data.winner;
      for (const [ideaId, ideaData] of Object.entries(scores)) {
          document.getElementById(`judge_score_${ideaId}`).innerText = ideaData.judge;
          document.getElementById(`audience_score_${ideaId}`).innerText = ideaData.audience;
          document.getElementById(`total_score_${ideaId}`).innerText = ideaData.total;
      }
      if (winner && winner.name) {
          document.getElementById("winner_name").innerText = winner.name;
          document.getElementById("winner_score").innerText = winner.score;
      }
    });





    function showToast(msg, category) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.style.background = category === "success" ? "#28a745" : "#dc3545";
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }
  </script>
</body>
</html>
